<div class="batch-container">
  <app-loader [show]="isLoading"></app-loader>
  
  <div class="search-section card">
    <h2>Search Batches</h2>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="search-controls">
        <div class="form-group">
          <label>Start Date</label>
          <input 
            type="date" 
            formControlName="startDate" 
            class="form-control" 
            placeholder="Start Date"
          >
        </div>
        <div class="form-group">
          <label>End Date</label>
          <input 
            type="date" 
            formControlName="endDate" 
            class="form-control" 
            placeholder="End Date"
          >
        </div>
        <div class="form-group">
          <label>Shift</label>
          <select formControlName="shift" class="form-control">
            <option value="">All Shifts</option>
            <option *ngFor="let s of shifts" [value]="s.value">{{ s.label }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Machine</label>
          <app-searchable-select
            [options]="machines"
            [labelKey]="'name'"
            [valueKey]="'id'"
            [placeholder]="'Select machine'"
            [defaultOption]="{ label: 'All machines', value: null }"
            formControlName="machineId"
          ></app-searchable-select>
        </div>
        <div class="button-group">
          <button type="submit" class="search-btn btn btn-sm btn-primary">
            <i class="fas fa-search"></i> Search
          </button>
          <button type="button" class="search-btn btn btn-sm btn-secondary" (click)="resetForm()">
            <i class="fas fa-undo"></i> Reset
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="action-buttons">
    <button routerLink="/batch/add" class="btn btn-sm btn-primary">
      <i class="fas fa-plus"></i> Add Batch
    </button>
  </div>

  <div class="batches-list card">
    <h2>Batches</h2>
    <p class="sub">Track production batches by date range, shift and machine</p>

    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>No</th>
            <th>Date</th>
            <th>Shift</th>
            <th>Batch Name</th>
            <th>Resign Use</th>
            <th>Resign Opening</th>
            <th>CPW Use</th>
            <th>CPW Opening</th>
            <th>Machine</th>
            <th>Operator</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let batch of batches; let index = index">
            <td>{{ startIndex + index + 1 }}</td>
            <td>{{ batch.date | date:'dd-MM-yyyy' }}</td>
            <td>{{ getShiftLabel(batch.shift) }}</td>
            <td>{{ batch.name }}</td>
            <td>{{ batch.resignBagUse }}</td>
            <td>{{ batch.resignBagOpeningStock }}</td>
            <td>{{ batch.cpwBagUse }}</td>
            <td>{{ batch.cpwBagOpeningStock }}</td>
            <td>{{ getMachineName(batch.machineId) }}</td>
            <td class="operator-cell">
              <span class="operator-name" [title]="batch.operator">{{ batch.operator || 'N/A' }}</span>
            </td>
            <td class="actions">
              <button 
                class="btn-icon edit" 
                (click)="editBatch(batch.id)"
                title="Edit Batch"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button 
                class="btn-icon view" 
                (click)="viewBatch(batch.id)"
                title="View Batch Details"
              >
                <i class="fas fa-eye"></i>
              </button>
              <button 
                class="btn-icon delete" 
                (click)="deleteBatch(batch.id, batch.name)"
                title="Delete Batch"
              >
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="!batches?.length">
            <td colspan="11" class="text-center">
              <i class="fas fa-folder-open"></i> No batches found for the selected filters
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <app-pagination
      *ngIf="totalPages > 0"
      [currentPage]="currentPage"
      [pageSize]="pageSize"
      [totalElements]="totalElements"
      [pageSizeOptions]="pageSizeOptions"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
    ></app-pagination>
  </div>
</div>


