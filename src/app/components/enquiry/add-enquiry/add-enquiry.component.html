<div class="add-enquiry-container" *ngIf="form">
  <app-loader *ngIf="loading"></app-loader>

  <div class="header">
    <h2>{{ isEdit ? 'Edit Enquiry' : 'Add Enquiry' }}</h2>
    <div class="actions">
      <button class="btn secondary" type="button" routerLink="/enquiry">Back to List</button>
      <button class="btn primary" type="button" (click)="submit()">{{ isEdit ? 'Update' : 'Create' }}</button>
      <button *ngIf="isEdit" class="btn accent" type="button" (click)="openFollowupDialog()">
        <i class="fas fa-calendar-plus"></i> Add Follow-up
      </button>
    </div>
  </div>

  <form [formGroup]="form" class="form-grid premium-grid">
    <!-- Personal Information Section -->
    <div class="section-header">
      <h3>
        <i class="fas fa-user" aria-hidden="true"></i>
        Personal Information
      </h3>
    </div>

    <div class="row">
      <div class="form-row col-6">
        <label>Full Name <span class="required">*</span></label>
        <input 
          type="text" 
          formControlName="name" 
          placeholder="Enter full name"
          class="form-control"
        />
        <div class="error" *ngIf="(form.get('name')?.invalid && form.get('name')?.touched) || (submitted && form.get('name')?.invalid)">
          <span *ngIf="form.get('name')?.errors?.['required']">Name is required</span>
          <span *ngIf="form.get('name')?.errors?.['minlength']">Name must be at least 2 characters</span>
        </div>
      </div>
      <div class="form-row col-6">
        <label>Mobile Number <span class="required">*</span></label>
        <input 
          type="tel" 
          formControlName="mobile" 
          placeholder="Enter mobile number"
          class="form-control"
        />
        <div class="error" *ngIf="(form.get('mobile')?.invalid && form.get('mobile')?.touched) || (submitted && form.get('mobile')?.invalid)">
          <span *ngIf="form.get('mobile')?.errors?.['required']">Mobile number is required</span>
          <span *ngIf="form.get('mobile')?.errors?.['pattern']">Please enter a valid mobile number</span>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-row col-6">
        <label>Email Address <span class="optional">(Optional)</span></label>
        <input 
          type="email" 
          formControlName="mail" 
          placeholder="Enter email address"
          class="form-control"
        />
        <div class="error" *ngIf="(form.get('mail')?.invalid && form.get('mail')?.touched) || (submitted && form.get('mail')?.invalid)">
          <span *ngIf="form.get('mail')?.errors?.['email']">Please enter a valid email address</span>
        </div>
      </div>
      <div class="form-row col-6">
        <label>Enquiry Type <span class="optional">(Optional)</span></label>
        <input 
          type="text" 
          formControlName="type" 
          placeholder="Enter enquiry type (e.g., Person name)"
          class="form-control"
        />
      </div>
    </div>

    <!-- Company Information Section -->
    <div class="section-header">
      <h3>
        <i class="fas fa-building" aria-hidden="true"></i>
        Company Information
      </h3>
    </div>

    <div class="row">
      <div class="form-row col-12">
        <label>Company Name <span class="optional">(Optional)</span></label>
        <input 
          type="text" 
          formControlName="company" 
          placeholder="Enter company name"
          class="form-control"
        />
      </div>
    </div>

    <!-- Enquiry Details Section -->
    <div class="section-header">
      <h3>
        <i class="fas fa-question-circle" aria-hidden="true"></i>
        Enquiry Details
      </h3>
    </div>

    <div class="row">
      <div class="form-row col-12">
        <label>Subject <span class="optional">(Optional)</span></label>
        <input 
          type="text" 
          formControlName="subject" 
          placeholder="Enter enquiry subject"
          class="form-control"
        />
      </div>
    </div>

    <div class="row">
      <div class="form-row col-12">
        <label>Description <span class="optional">(Optional)</span></label>
        <textarea 
          formControlName="description" 
          placeholder="Enter detailed description of the enquiry"
          class="form-control textarea"
          rows="4"
        ></textarea>
      </div>
    </div>

    <!-- Address Information Section -->
    <div class="section-header">
      <h3>
        <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
        Address Information
      </h3>
    </div>

    <div class="row">
      <div class="form-row col-12">
        <label>Address <span class="optional">(Optional)</span></label>
        <textarea 
          formControlName="address" 
          placeholder="Enter complete address"
          class="form-control textarea"
          rows="3"
        ></textarea>
      </div>
    </div>

    <div class="row">
      <div class="form-row col-6">
        <label>City <span class="optional">(Optional)</span></label>
        <input 
          type="text" 
          formControlName="city" 
          placeholder="Enter city"
          class="form-control"
        />
      </div>
      <div class="form-row col-6">
        <label>State <span class="optional">(Optional)</span></label>
        <input 
          type="text" 
          formControlName="state" 
          placeholder="Enter state"
          class="form-control"
        />
      </div>
    </div>

    <!-- Enquiry Status Section -->
    <div class="section-header">
      <h3>
        <i class="fas fa-tasks" aria-hidden="true"></i>
        Enquiry Status
      </h3>
    </div>

    <div class="row">
      <div class="form-row col-12">
        <label>Status <span class="required">*</span></label>
        <div class="status-options">
          <div class="status-option" *ngFor="let option of statusOptions">
            <input 
              type="radio" 
              [id]="'status_' + option.value" 
              formControlName="status" 
              [value]="option.value"
            />
            <label [for]="'status_' + option.value" [class]="'status-label status-' + option.value.toLowerCase()">
              {{ option.label }}
            </label>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Follow-up History Section (Only visible in edit mode) -->
    <ng-container *ngIf="isEdit && currentId">
      <app-followup-history [enquiryId]="currentId"></app-followup-history>
    </ng-container>
  </form>
  <div class="header">
    <h2>{{ isEdit ? 'Edit Enquiry' : 'Add Enquiry' }}</h2>
    <div class="actions">
      <button class="btn secondary" type="button" routerLink="/enquiry">Back to List</button>
      <button class="btn primary" type="button" (click)="submit()">{{ isEdit ? 'Update' : 'Create' }}</button>
    </div>
  </div>
</div>
