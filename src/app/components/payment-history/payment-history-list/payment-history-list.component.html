<div class="payment-history-list-container">
  <div class="header-section">
    <h2 class="page-title">
      <i class="fas fa-history"></i> Payment History
    </h2>
    <button class="btn btn-primary" (click)="onAddNew()">
      <i class="fas fa-plus"></i> Add Payment
    </button>
  </div>

  <div class="search-section">
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="search-form">
      <div class="search-row">
        <!-- Search Query -->
        <div class="form-group">
          <input type="text" formControlName="search" placeholder="Search payment history..." class="form-control">
        </div>
        
        <!-- Customer Selection -->
        <div class="form-group">
          <app-searchable-select 
            formControlName="customerId" 
            [options]="customers" 
            labelKey="name" 
            valueKey="id"
            [placeholder]="'Select Customer'" 
            [searchPlaceholder]="'Search customers...'"
            [focusWidthPx]="300">
          </app-searchable-select>
        </div>
        
        <!-- Start Date -->
        <div class="form-group">
          <input type="date" formControlName="startDate" class="form-control" placeholder="Start Date">
        </div>
        
        <!-- End Date -->
        <div class="form-group">
          <input type="date" formControlName="endDate" class="form-control" placeholder="End Date">
        </div>
        
        <div class="button-group">
          <button type="submit" class="btn btn-outline-secondary" [disabled]="searchLoading">
            <i class="fas" [ngClass]="searchLoading ? 'fa-spinner fa-spin' : 'fa-search'"></i>
            {{ searchLoading ? 'Searching...' : 'Search' }}
          </button>
          <button type="button" class="btn btn-outline-secondary" (click)="resetSearchForm()" *ngIf="isSearchActive()">
            <i class="fas fa-times"></i> Clear
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="table-container">
    <div class="table-responsive">
      <table class="table payment-history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Customer</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Transaction</th>
            <th>Remarks</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of paymentHistories">
            <td>{{ payment.date }}</td>
            <td>{{ payment.customerName }}</td>
            <td>{{ payment.amount | number:'1.2-2' }}</td>
            <td>{{ getTypeLabel(payment.type) }}</td>
            <td>{{ getTransactionTypeLabel(payment.isReceived) }}</td>
            <td>{{ payment.remarks }}</td>
            <td class="actions">
              <button class="btn btn-sm btn-outline-primary" (click)="onEdit(payment)" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="onDelete(payment)" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="paymentHistories.length === 0 && !loading">
            <td colspan="7" class="text-center">No payment histories found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="pagination-section" *ngIf="totalElements > perPageRecord">
    <app-pagination 
      [currentPage]="currentPage" 
      [pageSize]="perPageRecord"
      [totalElements]="totalElements"
      (pageChange)="onPageChange($event)">
    </app-pagination>
  </div>
</div>

<app-loader *ngIf="loading"></app-loader>