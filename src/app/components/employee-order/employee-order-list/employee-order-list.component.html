<div class="employee-order-container">
  
  <div class="search-section card">
    <h2>Search Quotation Items</h2>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="search-controls">
        <div class="form-group">
          <app-searchable-select 
            formControlName="quotationItemStatus"
            [options]="quotationItemStatuses"
            labelKey="name"
            valueKey="id"
            [placeholder]="'All Status'"
            [searchPlaceholder]="'Search status...'">
          </app-searchable-select>
        </div>
        <div class="form-group input-with-refresh">
          <app-searchable-select 
            formControlName="brandId"
            [options]="brands"
            labelKey="name"
            valueKey="id"
            [placeholder]="'All Brands'"
            [searchPlaceholder]="'Search brands...'">
          </app-searchable-select>
          <button type="button" class="btn btn-secondary" (click)="refreshBrands()" [disabled]="isLoadingBrands">
            <i class="fas fa-sync" [ngClass]="{ spinning: isLoadingBrands }"></i>
          </button>
        </div>
        
        <div class="button-group">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-search"></i> Search
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            <i class="fas fa-undo"></i> Reset
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="employee-orders-list card" style="margin-top:16px;">
    <h2>Quotation Items</h2>
    <div class="table-responsive">
      <app-loader [show]="isLoadingQuotationItems"></app-loader>
      <table class="table">
        <thead>
          <tr>
            <th>No</th>
            <th>Product</th>
            <th>Brand</th>
            <th>Quantity</th>
            <th>Weight/Roll</th>
            <th>No. of Roll</th>
            <th>Created Roll</th>
            <th>Remarks</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of quotationItems; let i = index">
            <td>{{ (qiCurrentPage * qiPageSize) + i + 1 }}</td>
            <td>{{ item.productName }}</td>
            <td>{{ item.brandName }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.weightPerRoll }}</td>
            <td>{{ item.numberOfRoll }}</td>
            <td>{{ item.createdRoll }}</td>
            <td>{{ item.remarks }}</td>
            <td>
              <ng-container *ngIf="!isOperator; else readOnlyStatus">
                <app-searchable-select
                  [options]="quotationItemStatuses"
                  labelKey="name"
                  valueKey="id"
                  [placeholder]="'Select status'"
                  [searchPlaceholder]="'Search status...'"
                  [allowClear]="false"
                  (focus)="onStatusFocus(i)"
                  (ngModelChange)="onStatusChange(i, $event)"
                  [(ngModel)]="item.quotationItemStatus">
                </app-searchable-select>
              </ng-container>
              <ng-template #readOnlyStatus>{{ item.quotationItemStatus }}</ng-template>
            </td>
          </tr>
          <tr *ngIf="!quotationItems?.length && !isLoadingQuotationItems">
            <td colspan="9" class="text-center">No quotation items found</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="table-controls">
      <app-pagination
        *ngIf="qiTotalPages > 0"
        [currentPage]="qiCurrentPage"
        [pageSize]="qiPageSize"
        [totalElements]="qiTotalElements"
        [pageSizeOptions]="pageSizeOptions"
        (pageChange)="onQiPageChange($event)"
        (pageSizeChange)="onQiPageSizeChange($event)"
      ></app-pagination>
    </div>
  </div>
</div> 