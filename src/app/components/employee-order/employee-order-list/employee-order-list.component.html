<div class="employee-order-container">
  
  <div class="search-section card">
    <h2>Search Quotation Items</h2>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="search-controls">
        <div class="form-group">
        <app-searchable-select 
          formControlName="quotationItemStatuses"
            [options]="quotationItemStatuses"
            labelKey="name"
            valueKey="id"
            [multiple]="true"
            [placeholder]="'All Status'"
            [searchPlaceholder]="'Search status...'">
          </app-searchable-select>
        </div>
        <div class="form-group input-with-refresh">
          <app-searchable-select 
            formControlName="brandId"
            [options]="brands"
            labelKey="name"
            valueKey="id"
            [placeholder]="'All Brands'"
            [searchPlaceholder]="'Search brands...'">
          </app-searchable-select>
          <button type="button" class="btn btn-secondary" (click)="refreshBrands()" [disabled]="isLoadingBrands">
            <i class="fas fa-sync" [ngClass]="{ spinning: isLoadingBrands }"></i>
          </button>
        </div>
        
        <div class="button-group">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-search"></i> Search
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            <i class="fas fa-undo"></i> Reset
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="employee-orders-list card" style="margin-top:16px;">
    <h2>Quotation Items</h2>
    <div class="table-responsive">
      <app-loader [show]="isLoadingQuotationItems"></app-loader>
      <table class="table">
        <thead>
          <tr>
            <th>No</th>
            <th>Product</th>
            <th>Brand</th>
            <th>Quantity</th>
            <th>Weight/Roll</th>
            <th>No. of Roll</th>
            <th>Created Roll</th>
            <th>Remaining Roll</th>
            <th>Remarks</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of quotationItems; let i = index">
            <td>{{ (qiCurrentPage * qiPageSize) + i + 1 }}</td>
            <td>{{ item.productName }}</td>
            <td>{{ item.brandName }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.weightPerRoll }}</td>
            <td>{{ item.numberOfRoll }}</td>
            <td>{{ item.createdRoll }}</td>
            <td>{{ (item?.numberOfRoll || 0) - (item?.createdRoll || 0) }}</td>
            <td>{{ item.remarks }}</td>
            <td>
              <ng-container *ngIf="item.quotationItemStatus !== 'B'; else emptyBill">
                <span style="margin-right:8px;">
                  {{ getItemStatusLabel(item.quotationItemStatus) }}
                </span>
                <select
                  [ngModel]="item.quotationItemStatus"
                  (focus)="onItemStatusFocus(i)"
                  (change)="onItemStatusChange(i, $any($event.target).value)"
                >
                  <option *ngFor="let opt of getAvailableItemStatusOptions(item.quotationItemStatus)" [value]="opt.value">
                    {{ opt.label }}
                  </option>
                </select>
              </ng-container>
              <ng-template #emptyBill>
                
              </ng-template>
            </td>
          </tr>
          <tr *ngIf="!quotationItems?.length && !isLoadingQuotationItems">
            <td colspan="9" class="text-center">No quotation items found</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="table-controls">
      <app-pagination
        *ngIf="qiTotalPages > 0"
        [currentPage]="qiCurrentPage"
        [pageSize]="qiPageSize"
        [totalElements]="qiTotalElements"
        [pageSizeOptions]="pageSizeOptions"
        (pageChange)="onQiPageChange($event)"
        (pageSizeChange)="onQiPageSizeChange($event)"
      ></app-pagination>
    </div>
  </div>
</div> 